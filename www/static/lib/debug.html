<!doctype html>
<head>
    <meta charset="utf-8">
    <title>debug.oak | Oak programming language</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/lib.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="overlay">
            <div class="home">
                <a href="/">Oak</a>
            </div>
            <nav>
                <a href="/lib/"><span class="desktop">standard library</span><span class="mobile">stdlib</span></a>
                <a href="/posts/">blog</a>
                <a href="/#start">download</a>
                <a href="https://github.com/thesephist/oak" target="_blank">source ↗</a>
            </nav>
        </div>
    </header>
    <main aria-role="main">
        <article class="overlay stdlib">
            <h1>debug.oak</h1>
            <p class="meta">
                <a href="/lib/">&larr; Standard library</a>
                <a href="https://github.com/thesephist/oak/blob/main/lib/debug.oak">See on GitHub ↗</a>
            </p>
            <pre><code><span class="oak-comment">// libdebug contains utilities useful for debugging and inspecting runtime</span>
<span class="oak-comment">// values of Oak programs.</span>

<span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">println</span><span class="oak-colon">: </span><span class="oak-identifier">stdPrintln</span><span class="oak-newline">
	</span><span class="oak-identifier">default</span><span class="oak-colon">: </span><span class="oak-identifier">default</span><span class="oak-newline">
	</span><span class="oak-identifier">range</span><span class="oak-colon">: </span><span class="oak-identifier">range</span><span class="oak-newline">
	</span><span class="oak-identifier">toHex</span><span class="oak-colon">: </span><span class="oak-identifier">toHex</span><span class="oak-newline">
	</span><span class="oak-identifier">map</span><span class="oak-colon">: </span><span class="oak-identifier">map</span><span class="oak-newline">
	</span><span class="oak-identifier">each</span><span class="oak-colon">: </span><span class="oak-identifier">each</span><span class="oak-newline">
	</span><span class="oak-identifier">some</span><span class="oak-colon">: </span><span class="oak-identifier">some</span><span class="oak-newline">
	</span><span class="oak-identifier">every</span><span class="oak-colon">: </span><span class="oak-identifier">every</span><span class="oak-newline">
	</span><span class="oak-identifier">values</span><span class="oak-colon">: </span><span class="oak-identifier">values</span><span class="oak-newline">
	</span><span class="oak-identifier">reduce</span><span class="oak-colon">: </span><span class="oak-identifier">reduce</span><span class="oak-newline">
	</span><span class="oak-identifier">entries</span><span class="oak-colon">: </span><span class="oak-identifier">entries</span>
<span class="oak-rightBrace">} </span><span class="oak-assign">:= </span><span class="oak-fnName">import</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'std'</span><span class="oak-rightParen">)</span>
<span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">letter?</span><span class="oak-colon">: </span><span class="oak-identifier">letter?</span><span class="oak-newline">
	</span><span class="oak-identifier">digit?</span><span class="oak-colon">: </span><span class="oak-identifier">digit?</span><span class="oak-newline">
	</span><span class="oak-identifier">join</span><span class="oak-colon">: </span><span class="oak-identifier">join</span><span class="oak-newline">
	</span><span class="oak-identifier">padStart</span><span class="oak-colon">: </span><span class="oak-identifier">padStart</span>
<span class="oak-rightBrace">} </span><span class="oak-assign">:= </span><span class="oak-fnName">import</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'str'</span><span class="oak-rightParen">)</span>
<span class="oak-identifier">math </span><span class="oak-assign">:= </span><span class="oak-fnName">import</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'math'</span><span class="oak-rightParen">)</span>
<span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">sort!</span><span class="oak-colon">: </span><span class="oak-identifier">sort!</span>
<span class="oak-rightBrace">} </span><span class="oak-assign">:= </span><span class="oak-fnName">import</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'sort'</span><span class="oak-rightParen">)</span>
<span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">format</span><span class="oak-colon">: </span><span class="oak-identifier">format</span>
<span class="oak-rightBrace">} </span><span class="oak-assign">:= </span><span class="oak-fnName">import</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'fmt'</span><span class="oak-rightParen">)</span>

<span class="oak-comment">// _validIdent? reports if the given string is a valid name for an Oak</span>
<span class="oak-comment">// identifier. It's used to check if a string can appear without quotes as an</span>
<span class="oak-comment">// object key, or if it must be displayed as a string.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">_validIdent?</span><span class="oak-leftParen">(</span><span class="oak-identifier">s</span><span class="oak-rightParen">) </span><span class="oak-identifier">s </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">every</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-comma">, </span><span class="oak-identifier">i</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-identifier">i </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-numberLiteral">0 </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">letter?</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'_' </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'?' </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'!'</span><span class="oak-newline">
	</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">letter?</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-or">| </span><span class="oak-fnName">digit?</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'_' </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'?' </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'!'</span>
<span class="oak-rightBrace">}</span><span class="oak-rightParen">)</span>

<span class="oak-comment">// _numeral? reports if the given string represents a positive integer, used</span>
<span class="oak-comment">// for similar purposes to _validIdent?.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">_numeral?</span><span class="oak-leftParen">(</span><span class="oak-identifier">s</span><span class="oak-rightParen">) </span><span class="oak-identifier">s </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">every</span><span class="oak-leftParen">(</span><span class="oak-identifier">digit?</span><span class="oak-rightParen">)</span>

<span class="oak-comment">// _primitive? reports whether the given Oak value x is of a primitive or</span>
<span class="oak-comment">// function type, or a composite type composed of other Oak values.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">_primitive?</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-colon">:</span><span class="oak-identifier">null</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">empty</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">bool</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">int</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">float</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">string</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">atom</span><span class="oak-newline">
	</span><span class="oak-comment">// functions are considered "primitives" for the purpose of</span><span class="oak-newline">
	</span><span class="oak-comment">// inspect-printing because they're printed as `fn { ... }`</span><span class="oak-newline">
	</span><span class="oak-colon">:</span><span class="oak-identifier">function </span><span class="oak-branchArrow">-> </span><span class="oak-trueLiteral">true</span><span class="oak-newline">
	</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-falseLiteral">false</span>
<span class="oak-rightBrace">}</span>

<span class="oak-comment">// inspect is a utility to pretty-print Oak data structures. Unlike the</span>
<span class="oak-comment">// string() builtin (used in std.println), inspect formats its input with</span>
<span class="oak-comment">// customizable, nested indentation and spacing for readability in an output</span>
<span class="oak-comment">// log or console output.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspect</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">options</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-identifier">indent</span><span class="oak-colon">: </span><span class="oak-identifier">indentUnit</span><span class="oak-newline">
		</span><span class="oak-identifier">depth</span><span class="oak-colon">: </span><span class="oak-identifier">depth</span><span class="oak-newline">
		</span><span class="oak-identifier">maxLine</span><span class="oak-colon">: </span><span class="oak-identifier">maxLine</span><span class="oak-newline">
		</span><span class="oak-identifier">maxList</span><span class="oak-colon">: </span><span class="oak-identifier">maxList</span><span class="oak-newline">
		</span><span class="oak-identifier">maxObject</span><span class="oak-colon">: </span><span class="oak-identifier">maxObject</span><span class="oak-newline">
	</span><span class="oak-rightBrace">} </span><span class="oak-assign">:= </span><span class="oak-identifier">options </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-leftBrace">{</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">)</span>
<span class="oak-newline">
	</span><span class="oak-identifier">indentUnit </span><span class="oak-assign">:= </span><span class="oak-identifier">indentUnit </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'  '</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">depth </span><span class="oak-assign">:= </span><span class="oak-identifier">depth </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-minus">-</span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">maxLine </span><span class="oak-assign">:= </span><span class="oak-identifier">maxLine </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">80</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">maxList </span><span class="oak-assign">:= </span><span class="oak-identifier">maxList </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">16</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">maxObject </span><span class="oak-assign">:= </span><span class="oak-identifier">maxObject </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">3</span><span class="oak-rightParen">)</span>
<span class="oak-newline">
	</span><span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspectObjectKey</span><span class="oak-leftParen">(</span><span class="oak-identifier">key</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-fnName">_validIdent?</span><span class="oak-leftParen">(</span><span class="oak-identifier">key</span><span class="oak-rightParen">)</span><span class="oak-comma">, </span><span class="oak-fnName">_numeral?</span><span class="oak-leftParen">(</span><span class="oak-identifier">key</span><span class="oak-rightParen">) </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">key</span><span class="oak-newline">
		</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">key</span><span class="oak-comma">, </span><span class="oak-minus">-</span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-newline">
	</span><span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspectAbbreviated</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">list </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'[ {{0}} items... ]' </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">object </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'{ {{0}} entries... }' </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-newline">
	</span><span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">null</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">empty</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">bool</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">int</span><span class="oak-comma">, </span><span class="oak-colon">:</span><span class="oak-identifier">float </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">string</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">string </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\'' </span><span class="oak-plus">+ </span><span class="oak-leftParen">(</span><span class="oak-identifier">x </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-identifier">c </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\\' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\\\'</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\'' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\\''</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\n' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\n'</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\r' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\r'</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\f' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\f'</span><span class="oak-newline">
			</span><span class="oak-stringLiteral">'\t' </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\t'</span><span class="oak-newline">
			</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-ifKeyword">if </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-comment">// hex-format non-printable bytes</span><span class="oak-newline">
				</span><span class="oak-fnName">codepoint</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-less">&lt; </span><span class="oak-numberLiteral">32</span><span class="oak-newline">
				</span><span class="oak-fnName">codepoint</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-greater">> </span><span class="oak-numberLiteral">126 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'\\x' </span><span class="oak-pushArrow">&lt;&lt; </span><span class="oak-fnName">toHex</span><span class="oak-leftParen">(</span><span class="oak-fnName">codepoint</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">padStart</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">2</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'0'</span><span class="oak-rightParen">)</span><span class="oak-newline">
				</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">c</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">'\''</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">atom </span><span class="oak-branchArrow">-> </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">_validIdent?</span><span class="oak-leftParen">(</span><span class="oak-identifier">payload </span><span class="oak-assign">:= </span><span class="oak-fnName">string</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-trueLiteral">true </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">':' </span><span class="oak-plus">+ </span><span class="oak-fnName">string</span><span class="oak-leftParen">(</span><span class="oak-identifier">payload</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'atom({{0}})' </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">payload</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">function </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'fn { ... }'</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">list </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'[' </span><span class="oak-plus">+ </span><span class="oak-leftParen">(</span><span class="oak-identifier">x </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-rightParen">) </span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">join</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">', '</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">']'</span><span class="oak-newline">
		</span><span class="oak-colon">:</span><span class="oak-identifier">object </span><span class="oak-branchArrow">-> </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-numberLiteral">0 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'{}'</span><span class="oak-newline">
			</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'{ ' </span><span class="oak-plus">+ </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-fnName">entries</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
					</span><span class="oak-fnName">sort!</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
					</span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">entry</span><span class="oak-rightParen">) </span><span class="oak-fnName">inspectObjectKey</span><span class="oak-leftParen">(</span><span class="oak-identifier">entry</span><span class="oak-dot">.</span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">': ' </span><span class="oak-plus">+ </span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">entry</span><span class="oak-dot">.</span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
					</span><span class="oak-fnName">join</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">', '</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-rightBrace">} </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">' }'</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-newline">
	</span><span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspectMulti</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">indent</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-identifier">innerIndent </span><span class="oak-assign">:= </span><span class="oak-identifier">indent </span><span class="oak-plus">+ </span><span class="oak-identifier">indentUnit</span><span class="oak-newline">
		</span><span class="oak-ifKeyword">if </span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-colon">:</span><span class="oak-identifier">list </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">x </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">reduce</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'['</span><span class="oak-comma">, </span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">lines</span><span class="oak-comma">, </span><span class="oak-identifier">item</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-identifier">lines </span><span class="oak-pushArrow">&lt;&lt; </span><span class="oak-stringLiteral">'\n' </span><span class="oak-plus">+ </span><span class="oak-identifier">innerIndent </span><span class="oak-plus">+ </span><span class="oak-fnName">inspectAny</span><span class="oak-leftParen">(</span><span class="oak-identifier">item</span><span class="oak-comma">, </span><span class="oak-identifier">innerIndent</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">) </span><span class="oak-pushArrow">&lt;&lt; </span><span class="oak-stringLiteral">'\n' </span><span class="oak-plus">+ </span><span class="oak-identifier">indent </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">']'</span><span class="oak-newline">
			</span><span class="oak-colon">:</span><span class="oak-identifier">object </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">entries</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">sort!</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">reduce</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'{'</span><span class="oak-comma">, </span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">lines</span><span class="oak-comma">, </span><span class="oak-identifier">entry</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-identifier">lines </span><span class="oak-pushArrow">&lt;&lt; </span><span class="oak-stringLiteral">'\n' </span><span class="oak-plus">+ </span><span class="oak-identifier">innerIndent </span><span class="oak-plus">+ </span><span class="oak-fnName">inspectObjectKey</span><span class="oak-leftParen">(</span><span class="oak-identifier">entry</span><span class="oak-dot">.</span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">': ' </span><span class="oak-plus">+</span><span class="oak-newline">
					</span><span class="oak-fnName">inspectAny</span><span class="oak-leftParen">(</span><span class="oak-identifier">entry</span><span class="oak-dot">.</span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-identifier">innerIndent</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">) </span><span class="oak-pushArrow">&lt;&lt; </span><span class="oak-stringLiteral">'\n' </span><span class="oak-plus">+ </span><span class="oak-identifier">indent </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">'}'</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-newline">
	</span><span class="oak-fnKeyword">fn </span><span class="oak-fnName">inspectAny</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">indent</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-identifier">line </span><span class="oak-assign">:= </span><span class="oak-fnName">inspectLine</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">depth </span><span class="oak-minus">- </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">overflows? </span><span class="oak-assign">:= </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">line</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">indent</span><span class="oak-rightParen">) </span><span class="oak-greater">> </span><span class="oak-identifier">maxLine</span><span class="oak-newline">
		</span><span class="oak-ifKeyword">if </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-fnName">_primitive?</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">line</span><span class="oak-newline">
			</span><span class="oak-identifier">depth </span><span class="oak-eq">= </span><span class="oak-numberLiteral">0 </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">inspectAbbreviated</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-identifier">overflows? </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">inspectMulti</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">indent</span><span class="oak-comma">, </span><span class="oak-identifier">depth </span><span class="oak-minus">- </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-eq">= </span><span class="oak-colon">:</span><span class="oak-identifier">list </span><span class="oak-branchArrow">-> </span><span class="oak-ifKeyword">if </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-greater">> </span><span class="oak-identifier">maxList</span><span class="oak-newline">
				</span><span class="oak-identifier">x </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">some</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-rightParen">) </span><span class="oak-exclam">!</span><span class="oak-fnName">_primitive?</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">inspectMulti</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">indent</span><span class="oak-comma">, </span><span class="oak-identifier">depth </span><span class="oak-minus">- </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
				</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">line</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-newline">
			</span><span class="oak-fnName">type</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-eq">= </span><span class="oak-colon">:</span><span class="oak-identifier">object </span><span class="oak-branchArrow">-> </span><span class="oak-ifKeyword">if </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-greater">> </span><span class="oak-identifier">maxObject</span><span class="oak-newline">
				</span><span class="oak-identifier">x </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">values</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">some</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-rightParen">) </span><span class="oak-exclam">!</span><span class="oak-fnName">_primitive?</span><span class="oak-leftParen">(</span><span class="oak-identifier">y</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-branchArrow">-> </span><span class="oak-fnName">inspectMulti</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">indent</span><span class="oak-comma">, </span><span class="oak-identifier">depth </span><span class="oak-minus">- </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
				</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">line</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-newline">
	</span><span class="oak-fnName">inspectAny</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-stringLiteral">''</span><span class="oak-comma">, </span><span class="oak-identifier">depth</span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span>

<span class="oak-comment">// println is a shorthand function to print the output of `inspect`. Note that</span>
<span class="oak-comment">// debug.println is not a drop-in replacement for std.println, because</span>
<span class="oak-comment">// std.println is variadic, but debug.println takes one argument and one</span>
<span class="oak-comment">// (optional) options object.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">println</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">options</span><span class="oak-rightParen">) </span><span class="oak-fnName">stdPrintln</span><span class="oak-leftParen">(</span><span class="oak-fnName">inspect</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-comma">, </span><span class="oak-identifier">options</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span>

<span class="oak-comment">// bar draws a histogram bar as a Unicode string, with 1 character representing</span>
<span class="oak-comment">// a value of "1". Very small but non-zero values are rounded up to the</span>
<span class="oak-comment">// smallest representable unit, as distinguishing them from zero is usually</span>
<span class="oak-comment">// more important at that scale than quantitative correctness.</span>
<span class="oak-comment">//</span>
<span class="oak-comment">// bar is used to render a histogram in histo.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">bar</span><span class="oak-leftParen">(</span><span class="oak-identifier">n</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">n </span><span class="oak-assign">:= </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">max</span><span class="oak-leftParen">(</span><span class="oak-identifier">n </span><span class="oak-times">* </span><span class="oak-numberLiteral">8</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">whole </span><span class="oak-assign">:= </span><span class="oak-fnName">int</span><span class="oak-leftParen">(</span><span class="oak-identifier">n </span><span class="oak-divide">/ </span><span class="oak-numberLiteral">8</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">rem </span><span class="oak-assign">:= </span><span class="oak-identifier">n </span><span class="oak-modulus">% </span><span class="oak-numberLiteral">8</span><span class="oak-newline">
	</span><span class="oak-identifier">graph </span><span class="oak-assign">:= </span><span class="oak-fnName">range</span><span class="oak-leftParen">(</span><span class="oak-identifier">whole</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn </span><span class="oak-stringLiteral">'█'</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">join</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-ifKeyword">if </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">round</span><span class="oak-leftParen">(</span><span class="oak-identifier">rem</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">0 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">''</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">1 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▏'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">2 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▎'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">3 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▍'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">4 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▌'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">5 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▋'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">6 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▊'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">7 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▉'</span><span class="oak-newline">
		</span><span class="oak-numberLiteral">8 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'█'</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span><span class="oak-newline">
	</span><span class="oak-ifKeyword">if </span><span class="oak-identifier">graph </span><span class="oak-eq">= </span><span class="oak-stringLiteral">'' </span><span class="oak-and">&amp; </span><span class="oak-identifier">n </span><span class="oak-greater">> </span><span class="oak-numberLiteral">0 </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-trueLiteral">true </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'▏'</span><span class="oak-newline">
		</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">graph</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-rightBrace">}</span>


<span class="oak-comment">// histo draws a histogram from a given list of numbers using Unicode symbols,</span>
<span class="oak-comment">// using bar to draw each bar.</span>
<span class="oak-fnKeyword">fn </span><span class="oak-fnName">histo</span><span class="oak-leftParen">(</span><span class="oak-identifier">xs</span><span class="oak-comma">, </span><span class="oak-identifier">opts</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">xs</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-numberLiteral">0 </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">''</span><span class="oak-newline">
	</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-leftBrace">{</span><span class="oak-newline">
		</span><span class="oak-identifier">opts </span><span class="oak-assign">:= </span><span class="oak-identifier">opts </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-leftBrace">{</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">min </span><span class="oak-assign">:= </span><span class="oak-identifier">opts</span><span class="oak-dot">.</span><span class="oak-identifier">min </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">min</span><span class="oak-leftParen">(</span><span class="oak-identifier">xs</span><span class="oak-ellipsis">...</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">max </span><span class="oak-assign">:= </span><span class="oak-identifier">opts</span><span class="oak-dot">.</span><span class="oak-identifier">max </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">max</span><span class="oak-leftParen">(</span><span class="oak-identifier">xs</span><span class="oak-ellipsis">...</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">bars </span><span class="oak-assign">:= </span><span class="oak-identifier">opts</span><span class="oak-dot">.</span><span class="oak-identifier">bars </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">10</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">min</span><span class="oak-leftParen">(</span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-identifier">xs</span><span class="oak-rightParen">)</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">max</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">label </span><span class="oak-assign">:= </span><span class="oak-identifier">opts</span><span class="oak-dot">.</span><span class="oak-identifier">label </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-qmark">?</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">cols </span><span class="oak-assign">:= </span><span class="oak-identifier">opts</span><span class="oak-dot">.</span><span class="oak-identifier">cols </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">default</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">80</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">unit </span><span class="oak-assign">:= </span><span class="oak-leftParen">(</span><span class="oak-identifier">max </span><span class="oak-minus">- </span><span class="oak-identifier">min</span><span class="oak-rightParen">) </span><span class="oak-divide">/ </span><span class="oak-identifier">bars</span>
<span class="oak-newline">
		</span><span class="oak-identifier">buckets </span><span class="oak-assign">:= </span><span class="oak-fnName">range</span><span class="oak-leftParen">(</span><span class="oak-identifier">bars</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn </span><span class="oak-numberLiteral">0</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">xs </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">each</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">x</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-identifier">x </span><span class="oak-geq">>= </span><span class="oak-identifier">min </span><span class="oak-and">&amp; </span><span class="oak-identifier">x </span><span class="oak-less">&lt; </span><span class="oak-identifier">max </span><span class="oak-branchArrow">-> </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-identifier">i </span><span class="oak-assign">:= </span><span class="oak-fnName">int</span><span class="oak-leftParen">(</span><span class="oak-leftParen">(</span><span class="oak-identifier">x </span><span class="oak-minus">- </span><span class="oak-identifier">min</span><span class="oak-rightParen">) </span><span class="oak-divide">/ </span><span class="oak-identifier">unit</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-identifier">buckets</span><span class="oak-dot">.</span><span class="oak-leftParen">(</span><span class="oak-identifier">i</span><span class="oak-rightParen">) </span><span class="oak-assign">:= </span><span class="oak-identifier">buckets</span><span class="oak-dot">.</span><span class="oak-leftParen">(</span><span class="oak-identifier">i</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-numberLiteral">1</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">maxcount </span><span class="oak-assign">:= </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">max</span><span class="oak-leftParen">(</span><span class="oak-identifier">buckets</span><span class="oak-ellipsis">...</span><span class="oak-rightParen">)</span>
<span class="oak-newline">
		</span><span class="oak-identifier">labels </span><span class="oak-assign">:= </span><span class="oak-identifier">buckets </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-identifier">string</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">maxlen </span><span class="oak-assign">:= </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">max</span><span class="oak-leftParen">(</span><span class="oak-identifier">labels </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-identifier">len</span><span class="oak-rightParen">)</span><span class="oak-ellipsis">...</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-ifKeyword">if </span><span class="oak-identifier">label </span><span class="oak-eq">= </span><span class="oak-colon">:</span><span class="oak-identifier">start </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">labels </span><span class="oak-assign">:= </span><span class="oak-identifier">labels </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">l</span><span class="oak-rightParen">) </span><span class="oak-identifier">l </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">padStart</span><span class="oak-leftParen">(</span><span class="oak-identifier">maxlen</span><span class="oak-comma">, </span><span class="oak-stringLiteral">' '</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
		</span><span class="oak-identifier">buckets </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">n</span><span class="oak-comma">, </span><span class="oak-identifier">i</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
			</span><span class="oak-identifier">b </span><span class="oak-assign">:= </span><span class="oak-identifier">n </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">math</span><span class="oak-dot">.</span><span class="oak-fnName">scale</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-identifier">maxcount</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-identifier">cols</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">bar</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
			</span><span class="oak-ifKeyword">if </span><span class="oak-identifier">label </span><span class="oak-leftBrace">{</span><span class="oak-newline">
				</span><span class="oak-colon">:</span><span class="oak-identifier">start </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">labels</span><span class="oak-dot">.</span><span class="oak-leftParen">(</span><span class="oak-identifier">i</span><span class="oak-rightParen">) </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">' ' </span><span class="oak-plus">+ </span><span class="oak-identifier">b</span><span class="oak-newline">
				</span><span class="oak-colon">:</span><span class="oak-identifier">end </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">b </span><span class="oak-plus">+ </span><span class="oak-stringLiteral">' ' </span><span class="oak-plus">+ </span><span class="oak-identifier">labels</span><span class="oak-dot">.</span><span class="oak-leftParen">(</span><span class="oak-identifier">i</span><span class="oak-rightParen">)</span><span class="oak-newline">
				</span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-identifier">b</span><span class="oak-newline">
			</span><span class="oak-rightBrace">}</span><span class="oak-newline">
		</span><span class="oak-rightBrace">}</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">join</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'\n'</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-rightBrace">}</span>
<span class="oak-rightBrace">}</span>

</code></pre>
        </article>
    </main>
    <footer>
        <div class="split overlay">
            <div class="left">
            </div>
            <div class="right">
                - <a href="https://thesephist.com/">Linus</a>
            </div>
        </div>
    </footer>
</body>
